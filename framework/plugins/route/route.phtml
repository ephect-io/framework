<?php

namespace Ephect\Plugins\Route;

use Ephect\Components\Component;
use Ephect\Plugins\Router\RouterService;
use Ephect\Registry\ComponentRegistry;
use Ephect\Registry\HttpErrorRegistry;

use function Ephect\Hooks\useEffect;
use function Ephect\Hooks\useState;

function Route($props)
{
    useEffect(function () use ($props, /* bool */ &$onError, /* string */ &$html) {
        $routeBuilder = new RouteBuilder($props);
        $route = $routeBuilder->build();

        $router = new RouterService();
        $router->addRoute($route);
        $router->saveRoutes();

        if (!IS_WEB_APP) {
            return;
        }

        $error = $route->getError();

        [$path, $query, $code] = $router->matchRoute($route);

        [$state, $setState] = useState();
        $routes = isset($state->routes) ? $state->routes : [];

        array_push($routes, ['path' => $path, 'query' => $query, 'error' => $error, 'code' => $code, ]);
        useState(['routes' => $routes]);

        // if ($code !== 200) {
        //     http_response_code($code);

        //     $onError = true;
        //     $html = 'Page not found';
        //     $html = ($code === 401) ? 'Bad request' : $html;
        //     return;
        // }

        // $comp = new Component($path);
        // $comp->render($query);
    });

    return (<<< HTML

    HTML);
}
