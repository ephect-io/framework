<?php

namespace Ephect\Plugins\WebComponent;

use Ephect\Framework\CLI\Console;

use function Ephect\Hooks\useEffect;

function WebComponent($children)
{

    useEffect(function($children, /* string */ $tag, /* string */ $args, /* string */ $body, $service) {

        $service = new WebComponentService($children);
        $manifest = $service->readManifest();
        $tag = $manifest->getTag();
        
        $body = $service->getBody($tag);
        if($body === null) {
            $args = $service->getAttributes();
            $body = <<< BODY
            <$tag $args>
            </$tag>
            BODY;
        }
    });

    return (<<< HTML
        {{ body }}
        {? 
            if(!{service}->isPending()) {
                {service}->markAsPending();
                {@html} = { children };
                {service}->splitHTML({@html});
                {service}->storeHTML({@html});
            }
        ?}
    HTML);
}
